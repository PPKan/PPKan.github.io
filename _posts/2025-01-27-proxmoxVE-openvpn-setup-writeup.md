---
layout: post
title: "Proxmox Virtual Environment + OpenVPN æ¶è¨­ write-up"
subtitle: ""
date: 2025-01-27
author: "Peter"
header-img: "img/post-bg-hack.jpg"
tags: [è³‡å®‰, ç¶²è·¯, VPN]
---

æ—¥å®‰ï¼Œæœ¬ç¯‡æ–‡ç« çš„ç›®çš„æ˜¯ç´€éŒ„ Proxmox VE èˆ‡ OpenVPN æ¶è¨­çš„æ­¥é©Ÿï¼ŒProxmox VE ä½œç‚ºè‡ªæ¶ç’°å¢ƒçš„å¥½å·¥å…·ï¼Œä½†ä½œç‚ºæ»²é€ç·´ç¿’çš„è©±é‚„æ˜¯è¦æŠŠç¶²è·¯å€éš”åšå¥½ï¼Œä¹Ÿå°±ç”¨äº† OpenVPN åšå¾ŒçºŒçš„è¨­å®šã€‚

é€™ç¯‡æ–‡ç« çš„ä¸»è¦ç›®çš„æ˜¯å…ˆå¯«èµ·ä¾†æ”¾ï¼Œæ€•ä¹‹å¾Œè¦é‡æ–°æ¶çš„æ™‚å€™å¿˜è¨˜ã€‚ï¼Œé †ä¾¿ä¹Ÿæ¢³ç†ä¸€ä¸‹éç¨‹ä¸­ç†è§£çš„æ±è¥¿ã€‚æ¶è¨­éç¨‹ä¸­å¤§å¹…åº¦åœ°é‹ç”¨äº† ChatGPT-O1ï¼Œç²ç›Šè‰¯å¤šï¼Œä½†éç¨‹ä¸­çš„å•é¡Œæ˜¯ä¸€å‘³åœ°ç…§æœ¬å®£ç§‘å¾ˆé›£æŠŠè¢«å‘ŠçŸ¥çŸ¥è­˜å…§åŒ–ï¼Œå…¶æ¬¡æ˜¯å°±ç®—æ˜¯ O1 å¾ˆé›£åœ¨æŒ‡é»ä¹‹å‰çµ¦äºˆè¶³å¤ çš„è—åœ–ï¼Œé€™ç¯‡æ–‡ç« æœƒå˜—è©¦ä»¥æ¯”è¼ƒé«˜è§’åº¦çš„æ–¹å¼å»é‡æ–°å‰–æç¶²è·¯æ‹“æ¨¸çš„éç¨‹ã€‚

å…§å®¹ä¸»è¦åˆ†æˆå…©å€‹å¤§å€å¡Šï¼ŒProxmox çš„æ¶è¨­èˆ‡å¾ŒçºŒåˆ©ç”¨ OpenVPN é€£åˆ°è™›æ“¬æ©Ÿçš„éç¨‹ï¼Œå‰é¢éƒ¨åˆ†ç¨å¾®å®¹æ˜“ä¸€äº›ä¹Ÿå¯«å¾—å¾ˆç± çµ±é‘’æ–¼ Proxmox çš„è¨­å®šéƒ½è »ç›´è¦ºçš„ï¼Œå”¯ç¨ wifi è¨­å®šéœ€è¦ä¸€äº›æ‰‹çºŒä½†ä¹Ÿä¸æ˜¯å¤ªå›°é›£ã€‚è€Œ OpenVPN çš„è¨­å®šå°±ç›¸å°æ¯”è¼ƒè¤‡é›œï¼Œä¹Ÿæ˜¯æˆ‘ç›¸å°é™Œç”Ÿçš„éƒ¨åˆ†ï¼Œé€™å€‹éƒ¨åˆ†ç”¨äº†ä¸€äº›åœ–è¡¨èˆ‡æŒ‡ä»¤ï¼Œè£¡é¢æˆ–å¤šæˆ–å°‘æœƒæœ‰äº›éºæ¼ï¼Œå¯«å¥½ä¹‹å¾Œé‚„æ²’æœ‰æŠŠé›»è…¦é‚„åŸé‡æ–° run éï¼Œä¹‹å¾Œæœ‰æ©Ÿæœƒé‡ run çš„è©±æœƒå†å¢æ·»å…§å®¹ã€‚

åœ¨æ­£æ–‡ä¹‹å‰æƒ³è¬›è¬›æ¶è¨­é€™å€‹çš„åŸå› ï¼Œæœ€è¿‘æƒ³è¦é–‹å§‹åœ¨è‡ªæ¶ç’°å¢ƒä¸­ç·´ç¿’ç´…è—éšŠçš„å…§å®¹ï¼Œæˆ‘ç›¸ä¿¡å¤šæ•¸äººæ‡‰è©²éƒ½æ˜¯ç”¨è‡ªå·±çš„é›»è…¦è·‘ VMwareã€‚ç„¡å¥ˆéå¹´æœŸé–“æ‰‹é‚Šåªæœ‰ä¸€å°è¼•è–„ç­†é›»è·Ÿä¸€å°ç¨è€ä¸€é»çš„é›»ç«¶ç­†é›»ï¼Œè¼•è–„ç­†é›»æ˜¯æˆ‘çš„å¤–å‡ºæ—¥å¸¸æ©Ÿï¼Œæ²’è¾¦æ³•é›™é–‹ Kali è·Ÿ Windowsï¼Œé€™é‚Šå°±ç”¨äº†è€èˆŠçš„ç­†é›»æ¶è¨­äº† Proxmox ä¾†è·‘è™›æ“¬ VM çš„ç’°å¢ƒã€‚

> æœ€æ ¹æœ¬çš„åŸå› æ˜¯é›²ç«¯ä¼ºæœå™¨å¯¦åœ¨å¤ªè²´äº†

## Proxmox æ¶è¨­

Proxmox çš„æ¶è¨­éç¨‹å¾ˆå®¹æ˜“ï¼Œæ‰¾ä¸€å€‹ USB æŠŠ ISO ç‡’éŒ„åˆ°è£¡é¢å³å¯ã€‚å…·é«”æ­¥é©Ÿå¯åƒè€ƒå®˜æ–¹æ–‡ä»¶ [Installing Proxmox VE](https://pve.proxmox.com/pve-docs/chapter-pve-installation.html)ï¼Œé€™é‚Šå°±ä¸å¤šè´…è¿°ã€‚

å®‰è£å®Œå¾ŒæŠŠé›»è…¦å¾ BIOS é–‹æ©Ÿå¾Œéœ€è¦æ³¨æ„çš„é»æ˜¯ç¶²è·¯ï¼ŒProxmox æ˜¯æ²’æœ‰ GUI çš„ OSï¼Œåœ¨é–‹æ©Ÿä¹‹å¾Œæœƒå½ˆå‡ºä¸€å€‹ç¶²å€å¦‚ä¸‹åœ–ï¼Œåœ–ç‰‡ä¾†æºï¼š[Install Proxmox VE {Step-by-Step Guide}](https://phoenixnap.com/kb/install-proxmox)

![Proxmox welcome output.](https://phoenixnap.com/kb/wp-content/uploads/2022/01/proxmox-welcome-output.png)

é€™å€‹æ­¥é©Ÿè¦ç‰¹åˆ¥æ³¨æ„çš„é»æ˜¯ï¼Œ**é›»è…¦å¦‚æœä¸å…ˆè¯ç¶²å¾Œé¢è¨­å®šå°±æœƒå¾ˆéº»ç…©**ï¼Œåœ¨å®‰è£éç¨‹ä¸­æœƒæœ‰ç¶²è·¯è¨­å®šï¼Œå¦‚æœé€™å€‹éšæ®µæ²’æœ‰å°±é€£æ¥åˆ°æœ‰è¨­å‚™å¯ä»¥å­˜å–çš„ç¶²æ®µçš„è©±å®‰è£èµ·ä¾†éº»ç…©å°±å¾ˆå¤šï¼Œé™¤æ­¤ä¹‹å¤–éƒ½é‚„å¥½ã€‚

### Wifi è¨­å®š

wifi è¨­å®šåƒè€ƒï¼š[TUTORIAL\ - HOWTO - Proxmox VE 8-1.2 Wifi w/ SNAT Proxmox Support Forum](https://forum.proxmox.com/threads/howto-proxmox-ve-8-1-2-wifi-w-snat.142831/)ï¼Œå…§å®¹ç…§è‘—è·‘éƒ½ä¸æœƒæœ‰å•é¡Œï¼Œä¸éæ–‡ç« ä¸­æ²’æœ‰æåˆ°çš„æ˜¯ï¼Œå¦‚æœä½ è¦è®“ä¸Šé¢çš„ Welcome message é¡¯ç¤ºç¶²å€æ›´æ”¹çš„è©±ï¼Œè¦è·Ÿè‘—ä¿®æ”¹ `/etc/hosts` ï¼Œæ”¹å®Œå°±å¥½äº†ã€‚

### å°‡ ISO æª”å­˜å…¥ä¼ºæœå™¨

è¨­å®šå®Œ OS å¾Œï¼Œæˆ‘å€‘è¦ä¾†é€²è¡Œæœ€é‡è¦çš„å»ºç«‹ VMï¼Œä½†åœ¨å»ºç«‹ VM ä¹‹å‰ï¼Œæ¯”è¼ƒå¥½çš„ç¿’æ…£æ˜¯å°‡ ISO æª”å…ˆå‚³å…¥ä¼ºæœå™¨ä¸­ï¼Œè®“ä¼ºæœå™¨å¯ä»¥ç©©å®šçš„æœ‰å€‹ ISO ä»¥å‚™ä¸æ™‚ä¹‹éœ€ã€‚

æˆ‘å€‘é€™é‚Šå‡è¨­å·²ç¶“æœ‰æ›è¼‰äº†ä¸€å€‹ç¡¬ç¢Ÿåœ¨ `/mnt/hdd` ï¼Œæˆ‘å€‘å…ˆåœ¨ç¡¬ç¢Ÿä¸­å»ºç«‹ä¸€å€‹è³‡æ–™å¤¾

```
mkdir -p /mnt/hdd/iso
```

å¾Œé¢å» Proxmox çš„ UI ä¸­çš„ `Datacenter > Storage` ä¸­æ–°å¢è³‡æ–™å¤¾å­˜æ”¾å€ã€‚å¦‚æœæœ‰å…¶ä»–çš„æª”æ¡ˆè¦æ–°å¢çš„è©±åŒæ¨£ä¹Ÿæ˜¯å¾é€™é‚Šé–‹è³‡æ–™å¤¾ã€‚

![image-20250125212505613](/img/in-post/proxmoxvewriteup/image-20250125212505613.png)

åœ¨é–‹å®Œä¹‹å¾Œå¾å·¦é‚Šæ¨™ç±¤é€²å»å°±å¯ä»¥ä¸Šå‚³ ISO æª”äº†ã€‚

![4123](/img/in-post/proxmoxvewriteup/4123.png)

### ç¶²è·¯è¨­å®šï¼ˆé‡è¦ï¼‰

åœ¨å»ºç«‹ VM çš„æ™‚å€™æˆ‘å€‘å¯ä»¥é¸æ“‡è®“ä»–æ–·ç¶²æˆ–æ˜¯ä¸æ–·ç¶²ï¼Œåœ¨é€™é‚Šæˆ‘å»ºè­°å…ˆæŠŠç¶²è·¯è¨­å®šå¥½ï¼Œå»ºç«‹å¥½ VM å¾Œå°±ç›´æ¥ç”¨å…§ç¶²è¨­å®šå»èµ°ã€‚æˆ‘å€‘é€™é‚Šåœ¨ host ä¸Šé–‹ä¸€å€‹ `10.10.0.1/24` çš„ç¶²è·¯å€æ®µï¼Œç”±æ–¼ç¶²æ®µæˆ‘å€‘ä¸åš NAT çš„é—œä¿‚ä¸æœƒä¸Šåˆ°å¤–ç¶²ï¼Œä½†åœ¨å¾ŒçºŒæˆ‘å€‘å› ç‚ºé‚„æ˜¯è¦åšç¶²æ®µå€éš”ï¼Œæ‰€ä»¥å¾Œé¢åŒæ¨£æœƒé–‹ forwardï¼Œä½†åªæœƒ forward åˆ°æˆ‘å€‘ OpenVPN æ‰€ä½¿ç”¨çš„ç¶²æ®µã€‚

![213213](/img/in-post/proxmoxvewriteup/213213.png)

### å»ºç«‹ VM

å³ä¸Šè§’æœ‰ä¸€å€‹è—è‰²çš„ Create VMï¼Œç…§è‘—åšåŸºæœ¬ä¸Šä¸æœƒæœ‰ä»€éº¼å•é¡Œï¼ŒCPUã€RAM ç­‰ç­‰å°±ä¾ç…§è‡ªå·±éœ€æ±‚è¨­å®šã€‚è¦æ³¨æ„çš„æ˜¯ windows VM åœ¨å»ºç«‹ä¹‹å¾Œè¦çŒé©…å‹•ï¼Œå…·é«”åƒè€ƒï¼š[Paravirtualized Block Drivers for Windows - Proxmox VE](https://pve.proxmox.com/wiki/Paravirtualized_Block_Drivers_for_Windows#Setup_During_Windows_Installation)ã€‚å¾Œé¢æŠŠ ISO æª”æ›è¼‰é€²å»å³å¯ã€‚

![image-20250125213907389](/img/in-post/proxmoxvewriteup/image-20250125213907389.png)

åˆ°é€™å€‹æ­¥é©Ÿæˆ‘å€‘çš„ windows å°±åŸºæœ¬ä¸Šå·²ç¶“è¨­å®šå¥½äº†ï¼Œæ¥ä¸‹ä¾†è¦æº–å‚™çš„æ˜¯è¨­å®š OpenVPN ä¾†è®“æˆ‘å€‘çš„ Kali å¯ä»¥é€£éå»ã€‚

## OpenVPN æ¶è¨­

åœ¨ä¸Šä¸€å€‹éšæ®µï¼Œæˆ‘å€‘æˆåŠŸåœ°æ¶è¨­äº† Proxmox VE çš„ OS ä»¥åŠå»ºç«‹äº†ä¸€å€‹ Windows çš„ VMï¼Œä½†æˆ‘å€‘ç›®å‰é‚„æ²’æœ‰è¾¦æ³•å°‡æˆ‘å€‘çš„æ”»æ“Šæ©Ÿé€£ä¸Šå»ï¼Œç‚ºäº†é€£ä¸Šæˆ‘å€‘é‚„è¦è¨­å®š OpenVPNï¼Œä¸éå¤§å®¶å¯èƒ½æœƒæƒ³èªªæ˜æ˜ç›´æ¥æŠŠ VM æ›åœ¨å…§ç¶²å°±å¥½äº†ï¼Œç‚ºä»€éº¼è¦ç‰¹åœ°é€™æ¨£åšï¼Œæˆ‘æƒ³èŠèŠé€™æ¨£åšå¯èƒ½çš„å¥½è™•ï¼š

1. é¿å…æ¥è§¸å¤–ç¶²ï¼ˆWANï¼‰ï¼Œåœ¨åšæ»²é€æ¸¬è©¦ç·´ç¿’çš„æ™‚å€™ï¼Œæˆ‘å€‘å¤šåŠä¸å¸Œæœ›æˆ‘å€‘çš„è™›æ“¬æ©Ÿæ˜¯å¯ä»¥ä¸Šç¶²çš„ç‹€æ…‹ï¼Œå¦‚æœè¦ä¸Šç¶²åšä¸€äº›è¨­å®šçš„è©±å¯ä»¥å¦å¤–å†å¼„ã€‚
2. å¦‚æœå–®ç´”è·Ÿæ‰€æœ‰è¨­å‚™è™•åœ¨åŒä¸€å€‹å…§ç¶²ç’°å¢ƒç”¨é˜²ç«ç‰†å»åšåˆ†å‰²ä¹Ÿä¸æ˜¯ä¸è¡Œï¼Œä½†æ‰€æœ‰è¨­å‚™æ··åœ¨åŒä¸€å€‹ç¶²æ®µä¸‹å°±æœƒé¡¯å¾—æŒºäº‚çš„ï¼Œè€Œä¸”ä¸€å€‹æ²’è¨­å®šå¥½å°±å¾ˆå®¹æ˜“äº‚å¥—ï¼Œä¸¦ä¸”ï¼Œé€™æ¨£çš„æƒ…æ³ä¸‹å…¶ä»–ä»»æ„çš„è¨­å‚™ä¹Ÿéƒ½å¯ä»¥ç›´æ¥å­˜å–åˆ°æˆ‘å€‘çš„è™›æ“¬æ©Ÿã€‚
3. æ›´å¤šçš„å€æ®µåˆ†å‰²ï¼Œå¦‚æœå°‡ç¶²è·¯åˆ†é–‹çš„è©±å¯ä»¥è®“ VM å€‘æœ‰å€‹æ›´å¥½çš„ç’°å¢ƒç›¸äº’æºé€šã€‚é€™é‚Šçš„åšæ³•æ˜¯é€£ VPN ä¸Šçš„ Kali ä¹Ÿä¸æœƒè·Ÿ VM å¾…åœ¨åŒä¸€å€‹ç¶²è·¯ä¸‹ï¼Œè€Œæ˜¯èµ° OpenVPN çš„ post routing ã€‚

ç¶²è·¯çµæ§‹å¦‚æœæ•´ç†æˆåœ–çš„è©±æœƒåƒä¸‹é¢é€™æ¨£ï¼Œæˆ‘å€‘çš„ Kali Client è·Ÿ Proxmox VE ä¼ºæœå™¨æœƒåŒè™• OpenVPN çš„ä¸»è¦ä¼ºæœå™¨ `10.8.0.0/24`ï¼Œä½†æˆ‘å€‘çš„ VM æœƒè¨­å®šåœ¨ä¸Šé¢è¨­å®šçš„ `vmbr1` ä¹Ÿå°±æ˜¯ `10.10.0.0/24` è£¡é¢ï¼Œé€™é‚Šæœƒé€é OpenVPN çš„ pust route çš„æ–¹å¼å°‡ `10.8.0.0/24` çš„ç¶²è·¯ route è‡³ `10.10.0.0/24` ã€‚

![openvpn-topology](/img/in-post/proxmoxvewriteup/openvpn-topology.png)

ææ¸…æ¥šä¸Šé¢é‚è¼¯çš„è©±ï¼Œæˆ‘å€‘è¦åšçš„äº‹æƒ…å°±æœƒå¾ˆæ˜ç¢º

1. è¨­å®š Proxmox VE ç¶²æ®µè‡³ `10.10.0.0/24`

2. è¨­å®š OpenVPN

   a. æ¶è¨­ VPN ä¼ºæœå™¨èˆ‡è¨­å®šï¼Œä¸»ä¼ºæœå™¨ç‚º `10.8.0.0`ï¼Œä¸¦è¦å°‡ `10.8.0.0` ç¶“ç”± OpenVPN push route è‡³ `10.10.0.0`

   b. è¨­å®š VM çš„ IP èˆ‡ gateway åˆ†é…

   c. å»ºç«‹é€£ç·šç”¨çš„æ†‘è­‰ï¼Œè®“ Kali å¯ä»¥é€£ç·šéå»

### è¨­å®š OpenVPN ä¼ºæœå™¨èˆ‡è¨­å®š

æœ‰é‘‘æ–¼ Proxmox çš„ç¶²è·¯è¨­å®šå·²ç¶“åœ¨ä¸Šé¢ç¶²è·¯è¨­å®šçš„éƒ¨åˆ†è¨­å®šå®Œæˆäº†ï¼Œæˆ‘å€‘çš„ Server è·Ÿ VM é€™æ™‚å€™éƒ½é€£ä¸Šäº† `vmbr1` ä¹Ÿå°±æ˜¯ `10.10.0.0/24` çš„ç¶²æ®µï¼Œæˆ‘å€‘æ¥ä¸‹ä¾†å‰‡éœ€è¦æ¶è¨­ OpenVPN ä¼ºæœå™¨ï¼Œè®“ Kali å¯ä»¥ç¶“ç”± VPN é€£ä¸Š VMã€‚

OpenVPN çš„è¨­å®šç›¸å°å®¹æ˜“ï¼Œæˆ‘å€‘é¦–å…ˆè¦å…ˆæ¶è¨­ä¼ºæœå™¨ï¼Œç‚ºäº†æ¶è¨­ä¼ºæœå™¨æˆ‘å€‘éœ€è¦å»ºç«‹æ†‘è­‰èˆ‡é…ç½®ã€‚

```bash
# å®‰è£å¿…è¦å…ƒä»¶
apt-get update
apt-get install openvpn easy-rsa

# ä½¿ç”¨ easy-rsa å»ºç«‹ OpenVPN æ†‘è­‰
# åˆ©ç”¨ make-cadir å»ºç«‹æ†‘è­‰çš„è³‡æ–™å¤¾ (make-ca-directory)
make-cadir /etc/openvpn/easy-rsa
# CD è‡³è©²è³‡æ–™å¤¾
cd /etc/openvpn/easy-rsa
# åˆå§‹åŒ– PKI é‡‘é‘°èˆ‡å»ºç«‹ CA æ†‘è­‰ï¼Œè¨˜å¾—æ‰“å¯†ç¢¼
./easyrsa init-pki
./easyrsa build-ca
# ç”Ÿæˆ Server ç«¯æ†‘è­‰èˆ‡é‡‘é‘°ï¼Œnopass å¯è¦–éœ€æ±‚æ›´æ”¹ï¼Œä½†ç‚ºäº†ä¼ºæœå™¨éƒ¨å±¬ä¾¿åˆ©æ€§é€™é‚Šæ²’ç”¨
./easyrsa build-server-full server nopass
# ç”Ÿæˆ Diffie-Hellman åƒæ•¸åŠ å¼·å®‰å…¨
./easyrsa gen-dh
```

å¡«å…¥ OpenVPN ä¼ºæœå™¨é…ç½®

```bash
# /etc/openvpn/server.conf
port 1194
proto udp
dev tun

# æ†‘è­‰ç›¸é—œä½ç½®
ca /etc/openvpn/easy-rsa/pki/ca.crt
cert /etc/openvpn/easy-rsa/pki/issued/server.crt
key /etc/openvpn/easy-rsa/pki/private/server.key
dh /etc/openvpn/easy-rsa/pki/dh.pem

# æŒ‡å®š VPN è™›æ“¬ç¶²æ®µ
server 10.8.0.0 255.255.255.0

# å…è¨±ç”¨æˆ¶ç«¯ä¹‹é–“äº’é€š (Optional)
client-to-client

# å…è¨±è½‰ç™¼ç¶²æ®µ
push "route 10.10.0.0 255.255.255.0"

keepalive 10 120
persist-key
persist-tun
comp-lzo no
user nobody
group nogroup
verb 3
```

é€™é‚Šæœ‰å¹¾å€‹é»å¯ä»¥èªªæ˜ï¼Œé¦–å…ˆæ˜¯æ†‘è­‰æ˜¯æˆ‘å€‘ä¸Šé¢ç”Ÿæˆçš„é‡‘é‘°èˆ‡DHï¼Œå…¶æ¬¡æ˜¯ VPN çš„ç¶²æ®µï¼Œåœ¨é€™é‚Šæˆ‘å€‘è¨­å®šäº† `10.8.0.0`ï¼Œæœ€å¾Œæˆ‘å€‘ä½¿ç”¨ `push "route 10.10.0.0 255.255.255.0"` è®“æµé‡å¯ä»¥é †åˆ©å¾ `10.8.0.0` éåˆ° `10.10.0.0`ã€‚

æ¥ä¸‹ä¾†å°±å¯ä»¥æ¸¬è©¦äº†

```bash
systemctl enable openvpn@server
systemctl start openvpn@server
systemctl status openvpn@server
```

é€™å€‹æ­¥é©Ÿç†æ‡‰ä¸æœƒå‡ºç¾å ±éŒ¯è¨Šæ¯ã€‚

### è¨­å®š Windows VM çš„ IP

åŸºæœ¬ç…§è‘—ä¸‹åœ–è¨­å®šï¼Œé‡é»æ˜¯æ‰‹å‹•åˆ†é… IP è‡³ `10.10.0.10`ï¼ŒDNS å¯ä¾éœ€æ±‚è¨­å®šï¼Œæˆ‘é€™é‚Šæ˜¯ AD DC çš„é—œä¿‚æ‰€ä»¥è¨­å®šåœ¨è‡ªå·±çš„ IPã€‚

![image-20250127135441079](/img/in-post/proxmoxvewriteup/image-20250127135441079.png)

åœ¨é€™å€‹æ­¥é©Ÿæ™‚ï¼Œ`ipconfig` æ‡‰é¡¯ç¤º `10.10.0.10`ï¼Œä¸” Proxmox æ˜¯å¯ä»¥èˆ‡ VM çš„ IP äº’ ping çš„ã€‚

![image-20250127135829690](/img/in-post/proxmoxvewriteup/image-20250127135829690.png)

![image-20250127135650887](/img/in-post/proxmoxvewriteup/image-20250127135650887.png)

### è¨­å®š OpenVPN ç”¨æˆ¶ç«¯æ†‘è­‰

æˆ‘å€‘æŠŠä¼ºæœå™¨åŠVMç«¯è¨­å®šå¥½å¾Œï¼Œæ¥ä¸‹ä¾†éœ€è¦é€²è¡Œç”¨æˆ¶ç«¯ï¼Œåœ¨é€™é‚Šä¹Ÿå°±æ˜¯ Kali Linux çš„è¨­å®šã€‚

```bash
# åŒæ¨£ä½¿ç”¨ easy-rsa ç”Ÿæˆ client æ†‘è­‰ï¼Œç”Ÿæˆå¾Œæœƒåœ¨ 
# /etc/openvpn/easy-rsa/pki/private/kali-client.key
# /etc/openvpn/easy-rsa/pki/issued/kali-client.crt
cd /etc/openvpn/easy-rsa
./easyrsa build-client-full kali-client nopass
```

æ¥ä¸‹ä¾†æˆ‘å€‘éœ€è¦æ‰‹æ“ `kali-client.ovpn`ï¼Œé€™æ³¨æ„ä¿®æ”¹çš„æ˜¯ remote <IP> <PORT> è¨˜å¾—å°é½Š OpenVPN çš„è¨­å®š

```
client
dev tun
proto udp
remote 192.168.50.100 1194
resolv-retry infinite
nobind
persist-key
persist-tun
remote-cert-tls server
verb 3
comp-lzo no

<ca>
-----BEGIN CERTIFICATE-----
# /etc/openvpn/easy-rsa/pki/ca.crt
-----END CERTIFICATE-----
</ca>

<cert>
-----BEGIN CERTIFICATE-----
# /etc/openvpn/easy-rsa/pki/issued/kali-client.crt
-----END CERTIFICATE-----
</cert>

<key>
-----BEGIN PRIVATE KEY-----
# /etc/openvpn/easy-rsa/pki/private/kali-client.key
-----END PRIVATE KEY-----
</key>
```

æ¥ä¸‹ä¾†åœ¨ kali å®‰è£ OpenVPN ç†æ‡‰å°±å¯ä»¥é€£ä¸Šäº†ï¼Œé€é `traceroute` é©—è­‰ç¶²è·¯æ˜¯ç¶“ç”± OpenVPN çš„ `10.8.0.1` åˆ° `10.10.0.10` ã€‚åˆ°é€™é‚Šæˆ‘å€‘å°±é€é OpenVPN é€£åˆ°è™›æ“¬æ©Ÿï¼Œå®Œæˆ Proxmox Virtual Lab çš„æ¶è¨­ã€‚

```bash
# terminal 1
sudo apt install openvpn
sudo openvpn ./kali-client.ovpn

# terminal 2
$ traceroute 10.10.0.10
1  10.8.0.1 (10.8.0.1)  86.536 ms  88.117 ms  88.125 ms

$ ping 10.10.0.10
PING 10.10.0.10 (10.10.0.10) 56(84) bytes of data.
64 bytes from 10.10.0.10: icmp_seq=1 ttl=127 time=58.2 ms
64 bytes from 10.10.0.10: icmp_seq=2 ttl=127 time=82.8 ms
64 bytes from 10.10.0.10: icmp_seq=3 ttl=127 time=6.08 ms
64 bytes from 10.10.0.10: icmp_seq=4 ttl=127 time=19.7 ms
64 bytes from 10.10.0.10: icmp_seq=5 ttl=127 time=45.2 ms
```

## çµèª

ååˆ†ç°¡çŸ­çš„å¯«äº†ä¸€ç¯‡é—œæ–¼ Proxmox VE èˆ‡ OpenVPN çš„è¨­å®šï¼Œå…§å®¹ä¸»è¦æ˜¯æ¢³ç†å®‰è£éç¨‹ä¸æ‡‚çš„åœ°æ–¹ï¼Œä¸¦å˜—è©¦å°‡éç¨‹ç°¡æ½”èˆ‡åœ–åƒåŒ–ã€‚è£¡é¢é—œæ–¼ç¶²è·¯æ‹“æ¨¸çš„éƒ¨åˆ†ç›¸å°æ˜¯å­¸ç¿’åˆ°æ¯”è¼ƒå¤šçš„åœ°æ–¹ï¼Œä½†å°±å¦‚åŒæœ€ä¸Šé¢æ‰€èªªçš„ï¼Œç¶²è·¯è¨­å®šé€™å¡Šæˆ‘æ˜¯ç›¸å°é™Œç”Ÿçš„ï¼Œæœ‰éŒ¯èª¤çš„åœ°æ–¹é‚„è«‹å¤šåŒ…æ¶µï¼Œå…±åŒåŠªåŠ› ğŸ˜‰ğŸ‘ã€‚

---

æ„Ÿè¬é–±è®€ã€‚æœ¬æ–‡åŒæ­¥ç™¼è¡¨æ–¼FBç²‰çµ²å°ˆé  [PPå­¸ç¿’ç­†è¨˜](https://www.facebook.com/pplearningnote)ï¼Œæ­¡è¿åˆ†äº«èˆ‡ç•™è¨€è¨è«–ã€‚